<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/submit.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/submit.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* &lt;h3>Module contains various function to submit the solution and display the evaluated result respectively &lt;/h3>
* @module lib/submit
*/
var chalk = require('chalk');
var Preferences = require('preferences');
var Spinner = require('cli-spinner').Spinner;
var git = require('simple-git')();
var Table = require('cli-table');
/**
* @exports function as object
*/
/**
* Function does the following things : &lt;br>
* 1. Submits the result to be evaluated&lt;br>
* 2. Evaluates all result by checking all the answers with the given answer key
* 3. Prints the result as evaluated
* 4. Calculates and prints the total score for the given excercise
* @function submit
* @param {null}
* @return {null}
*/
module.exports = function() {
	var prefs = new Preferences('in.ac.bits-goa.autolab');
	var commit_hash;
	var spinner = new Spinner('Submitting results. Please wait ...');
	spinner.setSpinnerString(0);
	git.revparse(['--verify','HEAD'], function(err, data) {
		commit_hash = data;
		spinner.start();

		var socket = require('socket.io-client')(hostpref.host.host+':'+'9000');
		socket.emit('submission', [prefs.gitlab.username, 'lab0', commit_hash, hostpref.host.lang]);
		socket.on('invalid', function(data) {
			console.log(chalk.red('Access Denied. Please try submitting again'));
			process.exit(0);
		});

		socket.on('submission_pending',function(data) {
			console.log(chalk.yellow('You have a pending submission. Please try after some time.'));
			process.exit(0);
		});

		socket.on('scores', function(data) {
			total_score=0;
			console.log(chalk.green('\nSubmission successful. Retreiving results'));
			var table = new Table({
				chars: { 'top': '═' , 'top-mid': '╤' , 'top-left': '╔' , 'top-right': '╗',
				'bottom': '═' , 'bottom-mid': '╧' , 'bottom-left': '╚' , 'bottom-right': '╝',
				'left': '║' , 'left-mid': '╟' , 'mid': '─' , 'mid-mid': '┼',
				'right': '║' , 'right-mid': '╢' , 'middle': '│' },
				head: ['Test Case #', 'Status', 'Score'],
				colWidths: [15,25,15]
			});

			for(i=0;i&lt;data.marks.length;i++) {
		    	total_score=total_score+ parseInt(data.marks[i]);
		    	status = 'Accepted';
		    	if(data.comment[i]===0) {
		    		status='Wrong Answer';
		    	}
		    	if(data.comment[i]==1 &amp;&amp; data.marks[i]===0) {
		    		status='Compilation Error';
		    	}
		    	if(data.comment[i]==2 &amp;&amp; data.marks[i]===0) {
		    		status='Timeout';
		    	}
		    	table.push(
		    		[(i+1), status, data.marks[i]]
		    		);
		    }
		    console.log(table.toString());
		    if (total_score &lt; 0) {
		    	total_score = 0;
		    }
		    if (data.status!==0) {
		    	console.log(chalk.red('Penalty:') + data.penalty);
		    }
		    console.log('Total Score = ' + chalk.blue(total_score));
		    if (data.status===0) {
		    	console.log(chalk.yellow('Warning:') + 'This lab is not active. The result of this evaluation is not added to the scoreboard.');
		    }
		    console.log(new Buffer(data.log, 'base64').toString());
		    spinner.stop();
		    process.exit(0);
		});
	});
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-index.html">index</a></li><li><a href="module-lib_git.html">lib/git</a></li><li><a href="module-lib_help.html">lib/help</a></li><li><a href="module-lib_init.html">lib/init</a></li><li><a href="module-lib_rev.html">lib/rev</a></li><li><a href="module-lib_submit.html">lib/submit</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue Jun 13 2017 17:51:39 GMT+0530 (IST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
